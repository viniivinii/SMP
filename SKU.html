<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Controle de Mem√≥rias RAM</title>
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #1e1e1e;
      color: #fff;
      padding: 30px;
      max-width: 900px;
      margin: auto;
      font-size: 18px;
      animation: fadeIn 0.6s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
  }

    h2, h3 { 
      color: #ffffff;
      text-shadow: 1px 1px 2px #000; 
    }

    label {
      display: block;
      margin: 10px 0 5px;
      font-weight: bold;
    }

    input[type="text"], input[type="number"] {
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #444;
      background: #2b2b2b;
      color: white;
      font-size: 16px;
    }

    input[type="checkbox"] {
      margin-right: 6px;
      vertical-align: middle;
    }

    button {
      padding: 10px 15px;
      background-color: #808080;
      color: #ebebeb;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 10px;
      margin-right: 10px;
      box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
      transition: background-color 0.3s, transform 0.2s;
    }

    button:hover {
      background-color: #525252;
      transform: scale(1.03);
    }
    .sku-card {
      background: #fff;
      color: #000;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.4);
    }
    .pedido-container {
      border: 2px solid #fff;
      background: #c2c2c2;
      color: #000;
      padding: 15px;
      margin: 20px 0;
      border-radius: 10px;
      box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.4);
    }

    .flex-row {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .barcode {
      margin-top: 10px;
    }
    .hidden {
      display: none;
    }
    .button-row {
      margin-top: 10px;
    }
  </style>
</head>
<body>

  <img src="logo.png" alt="Logo" style="height: 60px; margin-bottom: 20px;">

  <h2>Separa√ß√£o de Mem√≥rias RAM</h2>

  <div id="telaInicio">
    <label for="pedido">N√∫mero do Pedido:</label>
    <input type="text" id="pedido" placeholder="Ex: 1050">
    <button id="btnIniciar">üöÄ Iniciar Pedido</button>
    <button id="btnHistorico">üìÅ Ver Hist√≥rico</button>
  </div>

  <div id="telaPedido" class="hidden">
    <div class="flex-row">
      <div style="flex: 0;">
        <label for="sku">SKU:</label>
        <input type="text" id="sku" placeholder="Ex: apenas n√∫meros">
      </div>
      <div style="flex: 1;">
        <label for="qtdMemorias">Qtd. de Mem√≥rias:</label>
        <input type="number" id="qtdMemorias" min="1" placeholder="Ex: 50">
      </div>
    </div>
    
    <div>
      <input type="checkbox" id="dissipador">
      <label for="dissipador">Com dissipador (22 por blister)</label>
    </div>
    <div class="button-row">
      <button onclick="adicionarSKU()">‚ûï Adicionar SKU</button>
      <button onclick="finalizarPedido()">üíæ Finalizar Pedido</button>
    </div>
    <h3>Resumo</h3>
    <p id="resumoPedido"></p>
    <div id="listaSkus"></div>
  </div>

  <div id="telaHistorico" class="hidden">
    <h3>üìú Hist√≥rico de Pedidos</h3>
    <div id="historicoContainer"></div>
    <button onclick="voltar()">üîô Voltar</button>
  </div>

  <script>
    let pedidoAtual = "";
    let pedidos = JSON.parse(localStorage.getItem("pedidosRAM") || "{}");
    let tempoInicio;

    window.addEventListener("DOMContentLoaded", () => {
      document.getElementById("btnIniciar").addEventListener("click", iniciarPedido);
      document.getElementById("btnHistorico").addEventListener("click", mostrarHistorico);
    });

    function iniciarPedido() {
      const pedido = document.getElementById("pedido").value.trim();
      if (!pedido) {
        alert("Informe o n√∫mero do pedido.");
        return;
      }

      if (pedidos[pedido]) {
        alert(`O pedido #${pedido} j√° existe no hist√≥rico. Use um n√∫mero diferente.`);
        return;
      }

      pedidoAtual = pedido;
      tempoInicio = new Date();
      document.getElementById("telaInicio").classList.add("hidden");
      document.getElementById("telaPedido").classList.remove("hidden");
      document.getElementById("resumoPedido").innerText = `Pedido #${pedido}`;
      pedidos[pedido] = { skus: [], inicio: tempoInicio };
    }

    function adicionarSKU() {
      let rawSku = document.getElementById("sku").value.trim();
      const qtdMemorias = parseInt(document.getElementById("qtdMemorias").value);
      const dissipador = document.getElementById("dissipador").checked;
      const porBlister = dissipador ? 22 : 25;

      if (!/^\d+$/.test(rawSku) || isNaN(qtdMemorias) || qtdMemorias <= 0) {
        alert("Preencha os dados corretamente. SKU deve conter apenas n√∫meros.");
        return;
      }

      const sku = `PC${rawSku}`;
      const skus = pedidos[pedidoAtual].skus;

      const existente = skus.find(item => item.sku === sku && item.dissipador === dissipador);
      if (existente) {
        // Atualiza a quantidade e o c√≥digo do SKU existente
        existente.qtdMemorias += qtdMemorias;
        existente.qtdBlisters = Math.ceil(existente.qtdMemorias / porBlister);
        existente.codigo = `${sku}-${existente.qtdMemorias}-${existente.qtdBlisters}`;
      } else {
        const qtdBlisters = Math.ceil(qtdMemorias / porBlister);
        const codigo = `${sku}-${qtdMemorias}-${qtdBlisters}`;
        skus.push({ sku, qtdMemorias, dissipador, qtdBlisters, codigo });
      }

      document.getElementById("sku").value = "";
      document.getElementById("qtdMemorias").value = "";
      document.getElementById("dissipador").checked = false;

      atualizarInterface();
    }

    function atualizarInterface() {
      const lista = document.getElementById("listaSkus");
      lista.innerHTML = "";
      pedidos[pedidoAtual].skus.forEach((item, index) => {
        const div = document.createElement("div");
        div.className = "sku-card";
        div.innerHTML = `
          <strong>SKU:</strong> ${item.sku}<br>
          <strong>Mem√≥rias:</strong> ${item.qtdMemorias}<br>
          <strong>Blisters:</strong> ${item.qtdBlisters}<br>
          <svg class="barcode" id="barcode-${index}"></svg><br>
        `;
        lista.appendChild(div);
        JsBarcode(`#barcode-${index}`, item.codigo, {
          format: "CODE128",
          displayValue: true,
          fontSize: 16,
          width: 2,
          height: 40
        });
      });
    }

    function finalizarPedido() {
      if (!pedidos[pedidoAtual] || pedidos[pedidoAtual].skus.length === 0) {
        alert("Adicione pelo menos um SKU antes de finalizar o pedido.");
        return;
      }

      pedidos[pedidoAtual].fim = new Date();
      localStorage.setItem("pedidosRAM", JSON.stringify(pedidos));
      alert("Pedido finalizado!");
      location.reload();
    }

    function mostrarHistorico() {
      document.getElementById("telaInicio").classList.add("hidden");
      document.getElementById("telaPedido").classList.add("hidden");
      document.getElementById("telaHistorico").classList.remove("hidden");

      const container = document.getElementById("historicoContainer");
      container.innerHTML = "";

      Object.entries(pedidos).forEach(([pedido, dados]) => {
        const div = document.createElement("div");
        div.className = "pedido-container";
        const tempo = (new Date(dados.fim) - new Date(dados.inicio)) / 1000;
        const minutos = Math.floor(tempo / 60);

        let html = `<h4>Pedido #${pedido}</h4>`;
        html += `<p>Separado em: ${minutos} minutos</p>`;
        html += `<button onclick="gerarPDF('${pedido}')">üñ®Ô∏è Imprimir Relat√≥rio</button>`;
        html += `<button onclick="excluirPedido('${pedido}')">üóëÔ∏è Excluir Pedido</button><hr>`;
        dados.skus.forEach((item, i) => {
          html += `
            <div class="sku-card">
              <strong>SKU:</strong> ${item.sku}<br>
              <strong>Mem√≥rias:</strong> ${item.qtdMemorias}<br>
              <strong>Blisters:</strong> ${item.qtdBlisters}<br>
              <svg id="barcode-h-${pedido}-${i}"></svg>
            </div>
          `;
        });

        div.innerHTML = html;
        container.appendChild(div);

        dados.skus.forEach((item, i) => {
          JsBarcode(`#barcode-h-${pedido}-${i}`, item.codigo, {
            format: "CODE128",
            displayValue: true,
            fontSize: 14,
            width: 2,
            height: 40
          });
        });
      });
    }

    function excluirPedido(pedido) {
      const pin = prompt("Digite o PIN para excluir:");
      if (pin === "3301") {
        delete pedidos[pedido];
        localStorage.setItem("pedidosRAM", JSON.stringify(pedidos));
        mostrarHistorico();
      } else {
        alert("PIN incorreto.");
      }
    }

    function gerarPDF(pedido) {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      let y = 10;
      doc.text(`Relat√≥rio do Pedido #${pedido}`, 10, y);
      y += 10;
      pedidos[pedido].skus.forEach((item) => {
        doc.text(`SKU: ${item.sku} - Mem√≥rias: ${item.qtdMemorias} - Blisters: ${item.qtdBlisters}`, 10, y);
        y += 10;
      });
      doc.save(`relatorio-pedido-${pedido}.pdf`);
    }

    function voltar() {
      document.getElementById("telaHistorico").classList.add("hidden");
      document.getElementById("telaInicio").classList.remove("hidden");
    }

//    function imprimirEtiqueta(codigo) {
//      const item = pedidos[pedidoAtual].skus.find(sku => sku.codigo === codigo);
//      
//      if (!item) {
//        alert("Item n√£o encontrado.");
//        return;
//      }
//
//      const { jsPDF } = window.jspdf;
//      const doc = new jsPDF();
//      
//      // Definindo a posi√ß√£o inicial para o texto
//      let y = 10;
//
//      // T√≠tulo da etiqueta
//      doc.setFontSize(16);
//      doc.text(`Etiqueta SKU: ${item.sku}`, 10, y);
//      y += 10;
//      
//      // Dados do SKU
//      doc.setFontSize(12);
//      doc.text(`Mem√≥rias: ${item.qtdMemorias}`, 10, y);
//      y += 10;
//      doc.text(`Blisters: ${item.qtdBlisters}`, 10, y);
//      y += 10;
//
//      // Gerando o c√≥digo de barras
//      JsBarcode("#barcode-" + codigo, item.codigo, {
//        format: "CODE128",
//        displayValue: true,
//        fontSize: 16,
//        width: 2,
//      height: 40
//      });
//
//      // Criando o c√≥digo de barras no PDF
//      const barcodeImg = document.getElementById("barcode-" + codigo);
//      doc.addImage(barcodeImg, "PNG", 10, y, 180, 40);
//      y += 50; // Ajuste a posi√ß√£o ap√≥s o c√≥digo de barras
//
//      // Salvando o PDF
//      doc.save(`etiqueta_${item.sku}.pdf`);
//    }

  </script>

</body>
</html>
